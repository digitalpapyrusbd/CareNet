generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ========== ENUMS ==========

enum UserRole {
  SUPER_ADMIN
  PLATFORM_ADMIN
  MODERATOR
  AGENCY
  AGENCY_ADMIN
  AGENCY_MANAGER
  CAREGIVER
  GUARDIAN
  PATIENT
  SHOP_ADMIN
  SHOP_MANAGER
}

enum KYCStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum PaymentMethod {
  BKASH
  NAGAD
  CARD
  BANK_TRANSFER
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum JobStatus {
  PENDING_ASSIGNMENT
  ACTIVE
  COMPLETED
  CANCELLED
  DISPUTED
}

enum AssignmentRole {
  PRIMARY
  BACKUP
}

enum AssignmentStatus {
  ASSIGNED
  ACTIVE
  COMPLETED
  REPLACED
}

enum CareLogType {
  CHECK_IN
  VITALS
  MEDICATION
  MEAL
  ACTIVITY
  INCIDENT
  CHECK_OUT
}

enum FeedbackType {
  CAREGIVER
  COMPANY
  AGENCY
  GUARDIAN
}

enum NotificationType {
  SMS
  EMAIL
  PUSH
  IN_APP
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  READ
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  RESOLVED
  CLOSED
}

enum DisputeType {
  PAYMENT
  QUALITY
  SAFETY
  NO_SHOW
  OTHER
}

enum BackgroundCheckStatus {
  PENDING
  CLEARED
  FLAGGED
}

enum SubscriptionTier {
  STARTER
  GROWTH
  ENTERPRISE
}

enum PackageCategory {
  ELDERLY_CARE
  POST_SURGERY
  CHRONIC_ILLNESS
  COMPANION
  NURSING
}

enum MobilityLevel {
  INDEPENDENT
  ASSISTED
  WHEELCHAIR
  BEDRIDDEN
}

enum CognitiveStatus {
  NORMAL
  MILD_IMPAIRMENT
  MODERATE
  SEVERE
}

enum HealthRecordType {
  PRESCRIPTION
  LAB_REPORT
  DIAGNOSIS
  MEDICATION_SCHEDULE
  NOTE
}

enum PayoutMethod {
  BANK_TRANSFER
  BKASH
  NAGAD
}

// NEW ENUMS for Enhanced Features

enum InvoiceType {
  CAREGIVER_TO_AGENCY
  AGENCY_TO_GUARDIAN
  PLATFORM_SUBSCRIPTION
  PLATFORM_COMMISSION
}

enum InvoiceStatus {
  DRAFT
  SENT
  PENDING
  PAID
  OVERDUE
  DISPUTED
}

enum AccountLockReason {
  PAYMENT_OVERDUE
  MANUAL_ADMIN_LOCK
  VERIFICATION_FAILED
  TOS_VIOLATION
}

enum NegotiationStatus {
  PENDING_AGENCY_RESPONSE
  PENDING_GUARDIAN_DECISION
  ACCEPTED
  DECLINED
  COUNTER_OFFERED
}

enum VerificationStepType {
  CERTIFICATES
  POLICE_CLEARANCE
  INTERVIEW
  PSYCHOLOGICAL_ANALYSIS
  DOCUMENT_CHECK
  FINAL_APPROVAL
}

enum VerificationDecision {
  PENDING
  MODERATOR_APPROVED
  ADMIN_APPROVED
  SENT_BACK
  REJECTED
}

// ========== CORE MODELS ==========

model users {
  id               String    @id @default(cuid())
  role             UserRole
  phone            String    @unique
  email            String?   @unique
  password_hash    String?
  name             String
  language         String    @default("en")
  kyc_status       KYCStatus @default(PENDING)
  kyc_document_url String?
  mfa_enabled      Boolean   @default(false)
  mfa_secret       String?
  last_login_at    DateTime?
  is_active        Boolean   @default(true)
  deleted_at       DateTime?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  agency_id        String?
  google_id        String?   @unique
  google_email     String?

  audit_logs                              audit_logs[]
  caregivers                              caregivers?
  disputes_disputes_againstTousers        disputes[]             @relation("disputes_againstTousers")
  disputes_disputes_raised_byTousers      disputes[]             @relation("disputes_raised_byTousers")
  feedbacks_feedbacks_to_user_idTousers   feedbacks[]            @relation("feedbacks_to_user_idTousers")
  feedbacks_feedbacks_from_user_idTousers feedbacks[]            @relation("feedbacks_from_user_idTousers")
  job_applications                        job_applications[]
  jobs                                    jobs[]
  notifications                           notifications[]
  patients                                patients[]
  payments                                payments[]
  user_devices                            user_devices[]
  verification_codes                      verification_codes[]
  agencies                                agencies?              @relation(fields: [agency_id], references: [id])
  shops                                   shops?
  verification_steps                      verification_steps[]
  account_lockouts                        account_lockouts[]
  subscriptions                           subscriptions[]
  package_negotiations                    package_negotiations[]
  conversations_created                   conversations[]        @relation("conversation_creator")
  messages_sent                           messages[]
  files                                   files[]

  @@index([kyc_status])
  @@index([role])
  @@index([email])
  @@index([phone])
}

model agencies {
  id                      String           @id @default(cuid())
  userId                  String           @unique
  agency_name             String
  trade_license           String
  trade_license_url       String?
  tin                     String?
  contact_person          String
  contact_phone           String
  contact_email           String?
  address                 String
  logo_url                String?
  description             String?
  specializations         Json?
  payout_method           PayoutMethod
  payout_account          String
  commission_rate         Decimal          @default(12.00)
  subscription_tier       SubscriptionTier @default(STARTER)
  subscription_expires_at DateTime?
  rating_avg              Decimal          @default(0.0)
  rating_count            Int              @default(0)
  is_verified             Boolean          @default(false)
  verification_notes      String?
  deleted_at              DateTime?
  created_at              DateTime         @default(now())
  updated_at              DateTime         @updatedAt

  caregivers       caregivers[]
  jobs             jobs[]
  marketplace_jobs marketplace_jobs[]
  packages         packages[]
  service_zones    service_zones[]
  users            users[]

  @@index([rating_avg])
  @@index([userId])
  @@index([is_verified])
}


model caregivers {
  id                      String                @id @default(cuid())
  userId                  String                @unique
  agency_id               String?
  company_id              String?
  nid                     String                @unique
  nid_url                 String
  photo_url               String
  date_of_birth           DateTime
  gender                  Gender
  address                 String
  location_lat            Decimal?
  location_lng            Decimal?
  skills                  Json
  certifications          Json?
  experience_years        Int                   @default(0)
  languages               Json                  @default("[\"bn\"]")
  availabilityCalendar    Json?
  hourly_rate             Decimal?
  background_check_status BackgroundCheckStatus @default(PENDING)
  background_check_date   DateTime?
  rating_avg              Decimal               @default(0.0)
  rating_count            Int                   @default(0)
  total_jobs_completed    Int                   @default(0)
  is_available            Boolean               @default(true)
  is_verified             Boolean               @default(false)
  deleted_at              DateTime?
  created_at              DateTime              @default(now())
  updated_at              DateTime              @updatedAt

  assignments_assignments_replaced_byTocaregivers  assignments[]      @relation("assignments_replaced_byTocaregivers")
  assignments_assignments_caregiver_idTocaregivers assignments[]      @relation("assignments_caregiver_idTocaregivers")
  care_logs                                        care_logs[]
  agencies                                         agencies?          @relation(fields: [agency_id], references: [id])
  users                                            users              @relation(fields: [userId], references: [id])
  job_applications                                 job_applications[]
  marketplace_jobs                                 marketplace_jobs[]

  @@index([skills])
  @@index([rating_avg])
  @@index([is_verified, is_available])
  @@index([agency_id])
}

model patients {
  id                      String          @id @default(cuid())
  user_id                 String?
  guardian_id             String
  name                    String
  date_of_birth           DateTime
  gender                  Gender
  blood_group             String?
  address                 String
  emergency_contact_name  String
  emergency_contact_phone String
  primaryConditions       Json?
  allergies               String?
  mobility_level          MobilityLevel   @default(INDEPENDENT)
  cognitive_status        CognitiveStatus @default(NORMAL)
  photoUrl                String?
  consent_data_sharing    Boolean         @default(false)
  consent_marketing       Boolean         @default(false)
  deletedAt               DateTime?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt

  care_logs      care_logs[]
  health_records health_records[]
  jobs           jobs[]
  users          users            @relation(fields: [guardian_id], references: [id])

  @@index([primaryConditions])
  @@index([guardian_id])
}

// ========== NEW MODELS ==========

model invoices {
  id              String         @id @default(cuid())
  invoice_number  String         @unique
  invoice_type    InvoiceType
  issuer_id       String
  recipient_id    String
  job_id          String?
  amount          Decimal
  commission_fee  Decimal?
  subscription_id String?
  description     String?
  due_date        DateTime
  status          InvoiceStatus  @default(SENT)
  paid_at         DateTime?
  payment_method  PaymentMethod?
  transaction_id  String?
  reminder_sent   Json?
  locked_at       DateTime?
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt

  @@index([recipient_id, status])
  @@index([due_date, status])
}

model account_lockouts {
  id                    String            @id @default(cuid())
  user_id               String
  reason                AccountLockReason
  triggering_invoice_id String?
  locked_features       Json
  active_features       Json
  locked_at             DateTime
  unlocked_at           DateTime?
  unlocked_by           String?
  unlock_reason         String?
  is_active             Boolean           @default(true)
  created_at            DateTime          @default(now())

  user users @relation(fields: [user_id], references: [id])

  @@index([user_id, is_active])
}

model package_negotiations {
  id                  String            @id @default(cuid())
  package_id          String
  guardian_id         String
  original_price      Decimal
  proposed_price      Decimal?
  proposed_changes    Json?
  guardian_message    String?
  agency_response     String?
  counter_price       Decimal?
  additional_services Json?
  status              NegotiationStatus @default(PENDING_AGENCY_RESPONSE)
  round_number        Int               @default(1)
  parent_id           String?
  expires_at          DateTime
  created_at          DateTime          @default(now())
  updated_at          DateTime          @updatedAt

  guardian users @relation(fields: [guardian_id], references: [id])

  @@index([guardian_id, status])
  @@index([package_id])
}

model subscriptions {
  id                   String           @id @default(cuid())
  user_id              String
  plan_type            String
  tier                 SubscriptionTier
  price                Decimal
  billing_cycle        String
  current_period_start DateTime
  current_period_end   DateTime
  is_active            Boolean          @default(true)
  auto_renew           Boolean          @default(true)
  cancelled_at         DateTime?
  created_at           DateTime         @default(now())
  updated_at           DateTime         @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([user_id, is_active])
}

model verification_steps {
  id                 String               @id @default(cuid())
  user_id            String
  step_type          VerificationStepType
  step_order         Int
  document_urls      Json?
  moderator_id       String?
  moderator_notes    String?
  moderator_decision DateTime?
  admin_id           String?
  admin_notes        String?
  admin_decision     VerificationDecision @default(PENDING)
  admin_decided_at   DateTime?
  resubmit_reason    String?
  created_at         DateTime             @default(now())
  updated_at         DateTime             @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@unique([user_id, step_type])
  @@index([admin_decision])
}

model conversations {
  id              String    @id @default(cuid())
  participant_ids Json
  type            String
  created_by      String
  last_message_at DateTime?
  created_at      DateTime  @default(now())

  creator  users      @relation("conversation_creator", fields: [created_by], references: [id])
  messages messages[]

  @@index([last_message_at])
}

model messages {
  id              String    @id @default(cuid())
  conversation_id String
  sender_id       String
  content         String
  attachment_urls Json?
  is_read         Boolean   @default(false)
  read_at         DateTime?
  created_at      DateTime  @default(now())

  conversation conversations @relation(fields: [conversation_id], references: [id])
  sender       users         @relation(fields: [sender_id], references: [id])

  @@index([conversation_id, created_at])
}

model shops {
  id           String   @id @default(cuid())
  user_id      String   @unique
  shop_name    String
  description  String?
  logo_url     String?
  address      String
  is_verified  Boolean  @default(false)
  is_active    Boolean  @default(true)
  rating_avg   Decimal  @default(0.0)
  rating_count Int      @default(0)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  user     users      @relation(fields: [user_id], references: [id])
  products products[]
  orders   orders[]

  @@index([user_id, is_active])
}

model products {
  id             String   @id @default(cuid())
  shop_id        String
  name           String
  description    String
  category       String
  price          Decimal
  stock_quantity Int
  image_urls     Json?
  is_active      Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  shop shops @relation(fields: [shop_id], references: [id])

  @@index([shop_id, is_active])
}

model orders {
  id               String   @id @default(cuid())
  shop_id          String
  customer_id      String
  items            Json
  total_amount     Decimal
  status           String
  shipping_address String
  tracking_number  String?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  shop shops @relation(fields: [shop_id], references: [id])

  @@index([shop_id, status])
}

// ========== EXISTING MODELS (Continued) ==========

model packages {
  id               String          @id @default(cuid())
  agency_id        String
  name             String
  description      String
  category         PackageCategory
  price            Decimal
  duration_days    Int
  hours_per_day    Int
  inclusions       Json
  exclusions       Json?
  caregiver_count  Int             @default(1)
  is_active        Boolean         @default(true)
  min_advance_days Int             @default(2)
  created_at       DateTime        @default(now())
  updated_at       DateTime        @updatedAt

  jobs      jobs[]
  agencies  agencies   @relation(fields: [agency_id], references: [id])

  @@index([is_active])
  @@index([category])
  @@index([agency_id])
}

model jobs {
  id                   String    @id @default(cuid())
  package_id           String
  patient_id           String
  agency_id            String?
  guardian_id          String
  start_date           DateTime
  end_date             DateTime
  status               JobStatus @default(PENDING_ASSIGNMENT)
  total_price          Decimal
  commission_amount    Decimal
  payout_amount        Decimal
  special_instructions String?
  completion_notes     String?
  cancelled_reason     String?
  cancelled_at         DateTime?
  cancelled_by         String?
  created_at           DateTime  @default(now())
  updated_at           DateTime  @updatedAt

  assignments assignments[]
  care_logs   care_logs[]
  disputes    disputes[]
  users       users         @relation(fields: [guardian_id], references: [id])
  agencies    agencies?     @relation(fields: [agency_id], references: [id])
  patients    patients      @relation(fields: [patient_id], references: [id])
  packages    packages      @relation(fields: [package_id], references: [id])
  payments    payments[]

  @@index([guardian_id])
  @@index([start_date, end_date])
  @@index([status])
  @@index([agency_id])
  @@index([patient_id])
}

model assignments {
  id                 String           @id @default(cuid())
  job_id             String
  caregiver_id       String
  role               AssignmentRole   @default(PRIMARY)
  shift_start_time   String
  shift_end_time     String
  days_of_week       Json
  status             AssignmentStatus @default(ASSIGNED)
  replaced_by        String?
  replacement_reason String?
  created_at         DateTime         @default(now())
  updated_at         DateTime         @updatedAt

  caregivers_assignments_replaced_byTocaregivers  caregivers? @relation("assignments_replaced_byTocaregivers", fields: [replaced_by], references: [id])
  caregivers_assignments_caregiver_idTocaregivers caregivers  @relation("assignments_caregiver_idTocaregivers", fields: [caregiver_id], references: [id])
  jobs                                            jobs        @relation(fields: [job_id], references: [id])
  care_logs                                       care_logs[]

  @@unique([job_id, caregiver_id, role])
  @@index([caregiver_id])
  @@index([job_id])
}

model care_logs {
  id                String      @id @default(cuid())
  job_id            String
  assignment_id     String
  caregiver_id      String
  patient_id        String
  log_type          CareLogType
  timestamp         DateTime
  location_lat      Decimal?
  location_lng      Decimal?
  data              Json
  notes             String?
  photo_urls        Json?
  guardian_notified Boolean     @default(false)
  createdAt         DateTime    @default(now())
  vitals            Json?
  activities        Json?

  patients    patients    @relation(fields: [patient_id], references: [id])
  caregivers  caregivers  @relation(fields: [caregiver_id], references: [id])
  assignments assignments @relation(fields: [assignment_id], references: [id])
  jobs        jobs        @relation(fields: [job_id], references: [id])

  @@index([log_type])
  @@index([timestamp])
  @@index([patient_id])
  @@index([caregiver_id])
  @@index([job_id])
}

model payments {
  id              String        @id @default(cuid())
  job_id          String
  payer_id        String
  amount          Decimal
  method          PaymentMethod
  transaction_id  String        @unique
  status          PaymentStatus @default(PENDING)
  invoice_number  String        @unique
  invoice_url     String?
  receipt_url     String?
  paid_at         DateTime?
  refund_amount   Decimal?
  refund_reason   String?
  gatewayResponse Json?
  created_at      DateTime      @default(now())
  updated_at      DateTime      @updatedAt

  escrows escrows?
  users   users    @relation(fields: [payer_id], references: [id])
  jobs    jobs     @relation(fields: [job_id], references: [id])

  @@index([transaction_id])
  @@index([status])
  @@index([job_id])
}

model escrows {
  id          String    @id @default(cuid())
  payment_id  String    @unique
  amount      Decimal
  fee         Decimal
  status      String    @default("HELD")
  released_at DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  payments payments @relation(fields: [payment_id], references: [id])

  @@index([status])
  @@index([payment_id])
}

model disputes {
  id                 String        @id @default(cuid())
  job_id             String
  raised_by          String
  against            String
  dispute_type       DisputeType
  description        String
  evidence_urls      Json?
  status             DisputeStatus @default(OPEN)
  assigned_moderator String?
  resolution         String?
  resolution_action  String?
  resolved_at        DateTime?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  users_disputes_againstTousers   users @relation("disputes_againstTousers", fields: [against], references: [id])
  users_disputes_raised_byTousers users @relation("disputes_raised_byTousers", fields: [raised_by], references: [id])
  jobs                            jobs  @relation(fields: [job_id], references: [id])

  @@index([assigned_moderator])
  @@index([status])
  @@index([job_id])
}

model feedbacks {
  id                    String       @id @default(cuid())
  job_id                String
  from_user_id          String
  to_user_id            String
  reviewee_type         FeedbackType
  rating                Int
  tags                  Json?
  comments              String?
  is_public             Boolean      @default(false)
  company_response      String?
  responded_at          DateTime?
  flagged_inappropriate Boolean      @default(false)
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  users_feedbacks_to_user_idTousers   users @relation("feedbacks_to_user_idTousers", fields: [to_user_id], references: [id])
  users_feedbacks_from_user_idTousers users @relation("feedbacks_from_user_idTousers", fields: [from_user_id], references: [id])

  @@unique([job_id, from_user_id, to_user_id])
  @@index([is_public, rating])
  @@index([job_id])
  @@index([to_user_id, reviewee_type])
}

model health_records {
  id          String           @id @default(cuid())
  patient_id  String
  record_type HealthRecordType
  title       String
  description String?
  file_url    String?
  metadata    Json?
  uploaded_by String?
  valid_from  DateTime?
  valid_until DateTime?
  is_archived Boolean          @default(false)
  created_at  DateTime         @default(now())
  updated_at  DateTime         @updatedAt

  patients patients @relation(fields: [patient_id], references: [id])

  @@index([record_type])
  @@index([patient_id])
}

model notifications {
  id            String             @id @default(cuid())
  userId        String
  type          NotificationType
  channel       String
  title         String?
  body          String
  data          Json?
  status        NotificationStatus @default(PENDING)
  sent_at       DateTime?
  delivered_at  DateTime?
  read_at       DateTime?
  error_message String?
  createdAt     DateTime           @default(now())

  users users @relation(fields: [userId], references: [id])

  @@index([sent_at])
  @@index([status])
  @@index([userId])
}

model audit_logs {
  id          String   @id @default(cuid())
  actor_id    String?
  actor_role  String?
  action_type String
  entity_type String
  entity_id   String
  changes     Json?
  ip_address  String?
  user_agent  String?
  timestamp   DateTime @default(now())

  users users? @relation(fields: [actor_id], references: [id])

  @@index([action_type])
  @@index([timestamp])
  @@index([entity_type, entity_id])
  @@index([actor_id])
}

model verification_codes {
  id        String    @id @default(cuid())
  userId    String
  code      String
  type      String
  expiresAt DateTime
  isUsed    Boolean   @default(false)
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  users users @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([code])
  @@index([expiresAt])
  @@index([isUsed])
}

model user_devices {
  id           String   @id @default(cuid())
  user_id      String
  device_id    String   @unique
  fcm_token    String
  platform     String
  app_version  String?
  is_active    Boolean  @default(true)
  last_seen_at DateTime @default(now())
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  users users @relation(fields: [user_id], references: [id])

  @@index([fcm_token])
  @@index([user_id, is_active])
}

model service_zones {
  id               String   @id @default(cuid())
  agency_id        String
  zone_name        String
  region_code      String
  boundary_geojson Json?
  is_active        Boolean  @default(true)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  agencies  agencies   @relation(fields: [agency_id], references: [id])

  @@index([region_code])
  @@index([agency_id])
}

model marketplace_jobs {
  id                 String    @id @default(cuid())
  company_id         String?
  agency_id          String
  title              String
  description        String
  location           String
  required_skills    Json
  start_date         DateTime
  duration_days      Int
  hours_per_day      Int
  offered_rate       Decimal
  status             String    @default("OPEN")
  applications_count Int       @default(0)
  filled_by          String?
  filled_at          DateTime?
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt

  job_applications job_applications[]
  caregivers       caregivers?        @relation(fields: [filled_by], references: [id])
  agencies         agencies?          @relation(fields: [agency_id], references: [id])

  @@index([start_date])
  @@index([status])
  @@index([agency_id])
}

model job_applications {
  id                 String    @id @default(cuid())
  marketplace_job_id String
  caregiver_id       String
  coverLetter        String?
  status             String    @default("PENDING")
  reviewed_by        String?
  reviewed_at        DateTime?
  review_notes       String?
  created_at         DateTime  @default(now())

  users            users?           @relation(fields: [reviewed_by], references: [id])
  caregivers       caregivers       @relation(fields: [caregiver_id], references: [id])
  marketplace_jobs marketplace_jobs @relation(fields: [marketplace_job_id], references: [id])

  @@unique([marketplace_job_id, caregiver_id])
  @@index([status])
  @@index([caregiver_id])
  @@index([marketplace_job_id])
}

model scheduled_tasks {
  id         String    @id @default(cuid())
  task_type  String
  job_id     String?
  execute_at DateTime
  payload    Json?
  createdAt  DateTime  @default(now())
  executedAt DateTime?
  status     String    @default("pending")
}

model escrow_records {
  id            String          @id @default(cuid())
  user_id       String
  amount        Float
  currency      String
  status        String
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  escrow_ledger escrow_ledger[]

  @@index([user_id])
}

model escrow_ledger {
  id               String         @id @default(cuid())
  escrow_record_id String
  transaction_type String
  amount           Float
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
  escrow_records   escrow_records @relation(fields: [escrow_record_id], references: [id])

  @@index([escrow_record_id])
}

model provider_transactions {
  id             String        @id @default(cuid())
  provider       String
  transaction_id String
  amount         Float
  currency       String
  status         PaymentStatus
  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt

  @@index([provider, transaction_id])
}

model files {
  id            String   @id @default(cuid())
  uploaded_by   String
  filename      String
  original_name String
  mime_type     String
  size          Int
  url           String
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  uploader users @relation(fields: [uploaded_by], references: [id])

  @@index([uploaded_by])
}
